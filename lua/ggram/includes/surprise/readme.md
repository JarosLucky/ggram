# Отправка .gif, .doc и других файлов с Gary's Mod сервера

> Эта возможность существует благодаря [Vogel](https://github.com/IVogel). Он создал конструктор Multipart запросов

Для отправки большинства запросов к Telegram API используется классический тип `application/x-www-form-urlencoded`. Для отправки файлов используется `multipart/form-data`. Второй тип запроса требует особой упаковки данных перед отправкой, но при этом он позволяет отправлять бинарные (non-alphanumeric) данные, в том числе различные файлы.

![](https://img.qweqwe.ovh/1633308905956.png)

Гмод разрешает записывать в файловую систему (file.Write) файлы только с расширениями .txt, .dat и еще [некоторыми другими](https://wiki.facepunch.com/gmod/file.Write), но при этом мы все равно можем скачать условно .gif, записать его как .txt, затем отправить этот .txt в телеграм как .gif и он успешно отобразится.

## Практическое применение

#### Скриншотер
Мы можем сделать скриншот от лица игрока на CLIENT, отправить его на SERVER, а с сервера отправить в Telegram чат. Таким образом можно сделать примитивный античит или [Stories канал проекта](https://t.me/trigon_stories) без сторонних WEB прослоек или .dll файлов.

#### Графики
При особом умении можно строить различные графики (кол-во энтити, экономика) и регулярно так же присылать их в какой-то чат или канал.

#### Стикеры
Я сделал чат-бота и могу отправлять Telegram стикеры в виде картинок во VKontakte

#### Бэкапы
Думаю, даже регулярные бекапы файлов сервера можно реализовать реализовать с этой возможностью. Собирать содержимое всех файлов, упаковывать их в какой-то примитивный архив и отправлять в специальный backup чат


## Примеры кода

Для начала где угодно создайте файл `test.lua`, сверху файла вставьте заготовку:

```lua
ggram.include("surprise/multipart")

-- вместо создания нового бота можете создавать ботов в global scope и переимспользовать их
local bot = ggram("123456789:QWERTYUIOPASDFGHJKLZXCVBNM")
local chat_id = 1234567 -- ID чата. Можно найти через t.me/jsonson_bot

local gif = file.Read("gif.txt", "DATA")

-- ...
```

В `garrysmod/data` должен быть файл gif.txt. Можете взять гифку где угодно и закинуть в data.


#### Отправка анимации

```lua
local gif = file.Read("gif.txt", "DATA")
bot.reply(chat_id).inlineKeyboard({{
	{text = "Кнопка!", callback_data = "any"}
}}).animationFromFile(gif, "anim.gif")
```

В примере также показано, что поддерживаются модификаторы запросов. Например, тут к анимации добавляется клавиатура


#### Отправка альбома

Обратите внимание, что один файл отправляется одновременно как "видео" (видео без звука в Telegram это анимация) и как изображение. Telegram сам разберется

```lua
local form_data = ggram.multipart.FormData()
	:AddFile("unique1", gif, "file.png")
	:AddFile("unique2", gif, "file.mp4")
	:AddTable("media", {
		{
			type = "photo",
			media = "attach://unique1",
			caption = "Hmm?"
		},
		{
			type = "video",
			media = "attach://unique2",
		},
	})

bot.reply(chat_id).silent().sendMultipart("sendMediaGroup", form_data)
```
