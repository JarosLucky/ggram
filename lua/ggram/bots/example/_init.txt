EXAMPLE_BOT = ggram("123456789:QWERTYUIOPASDFGHJKLZXCVBNM") -- replace with your token (t.me/BotFather)
local bot = EXAMPLE_BOT

bot.enable_polling() -- start getUpdates loop

bot.update(ggram.include("middlewares/session"), "session_middleware") -- middleware demo

local function deferred_sleep(time)
	local d = deferred.new()
	timer.Simple(time, function() d:resolve() end)
	return d
end

bot.update(function(ctx)
	ctx.reply.text("Sleeping 4 seconds")
	ctx.reply.action("typing")
	return deferred_sleep(4)
end, "sleep")

bot.command("test", function(ctx)
	local ses = ctx.session
	ses.presses = (ses.presses or 0) + 1

	return ctx.reply.text(ctx.text .. " pressed " .. ses.presses .. " times")
end)

bot.update(function(ctx)
	ctx.reply.text("Stopped. The 'done' text will not send. " ..
		"Just comment the return string or whole block to pass to the next function")

	return false
end, "stop_middl")

bot.update(function(ctx)
	ctx.reply.text("Done. It's the last middleware")
end, "done")
